<%- include("../partials/header") %>

<section class="toolbar">
  <form method="GET" action="/surveys" class="search-form">
    <input type="text" name="q" value="<%= q || '' %>" placeholder="Поиск: ID, название, описание" />
    <select name="category">
      <option value="">Все категории</option>
      <% categories.forEach((category) => { %>
        <option value="<%= category.slug %>" <%= selectedCategory === category.slug ? "selected" : "" %>><%= category.name %></option>
      <% }) %>
    </select>
    <button type="submit">Найти</button>
  </form>
</section>

<section class="list">
  <% if (!surveys.length) { %>
    <article class="card">Анкет пока нет.</article>
  <% } %>
  <% surveys.forEach((survey) => { %>
    <article class="survey-item">
      <div class="survey-meta">
        <span class="badge"><%= survey.category_name %></span>
        <span>Автор: <a href="/profile/<%= survey.user_id %>"><%= survey.username %></a></span>
        <span class="timer" data-countdown="<%= survey.end_at %>"></span>
      </div>
      <h2><a href="/surveys/<%= survey.id %>"><%= survey.title %></a></h2>
      <p><%= survey.description.length > 220 ? `${survey.description.slice(0, 220)}...` : survey.description %></p>
      <% if (survey.cover_path) { %>
        <img src="<%= survey.cover_path %>" alt="cover" class="survey-cover" />
      <% } %>
      <div class="survey-meta">
        <span>Ответов: <%= survey.responses_count %></span>
        <span>Комментариев: <%= survey.comments_count %></span>
        <span><%= survey.is_anonymous ? "Анонимная анкета" : "Публичная анкета" %></span>
      </div>
    </article>
  <% }) %>
</section>

<%- include("../partials/footer") %>
