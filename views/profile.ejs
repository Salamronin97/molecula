<%- include("partials/header") %>

<section class="profile-layout">
  <article class="profile-main-card">
    <div class="profile-top">
      <div class="profile-avatar-wrap">
        <% if (profileUser.avatar_path) { %>
          <img src="<%= profileUser.avatar_path %>" alt="avatar" class="profile-avatar" />
        <% } else { %>
          <div class="profile-avatar profile-avatar-fallback"><%= profileUser.username.slice(0, 1).toUpperCase() %></div>
        <% } %>
      </div>
      <div>
        <h1><%= profileUser.username %></h1>
        <div class="muted">ID: <%= profileUser.id %> · Регистрация: <%= profileUser.created_at %> <%= profileUser.is_admin ? "· Админ" : "" %></div>
      </div>
    </div>

    <p class="profile-bio"><%= profileUser.bio || "Пока без описания" %></p>

    <% if (currentUser && currentUser.id === profileUser.id) { %>
      <a class="toolbar-btn" href="/me/edit">Редактировать профиль</a>
    <% } %>
  </article>

  <article class="profile-favs-card">
    <div class="fav-head">Избранное / Топ тредов</div>
    <div class="fav-list">
      <% if (!favorites.length) { %>
        <div class="muted">Пока пусто.</div>
      <% } %>
      <% favorites.forEach((item) => { %>
        <a href="/polls/<%= item.id %>" class="fav-link"><%= item.category_name %> · <%= item.title %></a>
      <% }) %>
    </div>
    <div class="fav-footer">
      <span>Избранное</span>
      <span>Топ тредов</span>
    </div>
  </article>
</section>

<section class="profile-polls">
  <h2>Опросы пользователя</h2>
  <% if (!polls.length) { %>
    <article class="thread-card">Опросов пока нет.</article>
  <% } %>
  <% polls.forEach((poll) => { %>
    <article class="thread-card">
      <h3 class="thread-title"><a href="/polls/<%= poll.id %>"><%= poll.title %></a></h3>
      <div class="thread-foot">
        <span>Голосов: <%= poll.vote_count %></span>
        <span class="timer" data-countdown="<%= poll.end_at %>"></span>
      </div>
    </article>
  <% }) %>
</section>

<%- include("partials/footer") %>
